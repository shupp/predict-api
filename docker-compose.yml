version: "3.2"

networks:
  predict_net:
    driver: bridge

services:
  api:
    restart: always
    networks:
      - predict_net
    image: predictphp:latest
    environment:
        DB_CONNECTION: "mysql"
        DB_HOST: "mysql"
        DB_PORT: "3306"
        DB_DATABASE: "predictphp"
        DB_USERNAME: "root"
        DB_PASSWORD: "password"
        APP_NAME: "Predict API"
        APP_ENV: "local"
        APP_DEBUG: "true"
        APP_URL: "http://localhost:8080"
        APP_TIMEZONE: "America/Los_Angeles"
    # volumes:
      # - ${PWD}/predict-api/routes/:/predict-api/routes/
      # - ${PWD}/predict-api/app/:/predict-api/app/
    ports:
      - 8080:80
    depends_on:
      - mysql-seed-client
  mysql-seed-client:
    restart: "no"
    networks:
      - predict_net
    image: mariadb:latest
    environment:
       MYSQL_ROOT_PASSWORD: "password"
       MYSQL_DATABASE: "predictphp"
       MYSQL_USER: "predictphp"
       MYSQL_PASSWORD: "password"
    entrypoint: /sql/seed-mysql-data.sh
    volumes:
      - ./sql:/sql
    depends_on:
      - mysql
  mysql:
    restart: always
    networks:
      - predict_net
    ports:
      - target: "3306"
        protocol: "tcp"
    image: mariadb:latest
    environment:
       MYSQL_ROOT_PASSWORD: "password"
       MYSQL_DATABASE: "predictphp"
       MYSQL_USER: "predictphp"
       MYSQL_PASSWORD: "password"
